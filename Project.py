import telebot
from random import choice, randint
from telebot import types
from os import listdir
# BOT_TOKEN = YOUR BOT TOKEN
bot = telebot.TeleBot(BOT_TOKEN)


isStarted = False
isModeStarted = False

checker = True

Results = {
    'Correct_answers' : 0,
    'Incorrect_answers' : 0,
    'Points' : 0,
    'Coins' : 30
}
Tip = False
current_mode = ''
rand_list = []
list_years = []
year = ''
message_id = 0





# –ì–ª–æ–±–∞–ª—å–Ω–∞ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∞-–º–µ–Ω—é
markup_keyb_global = types.ReplyKeyboardMarkup()
button_1 = '–í–≥–∞–¥–∞–π –ª–æ–≥–æ—Ç–∏–ø'
button_2 = '–í–≥–∞–¥–∞–π –º–∞—Ä–∫—É –∑–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–º —Ñ–æ—Ç–æ'
button_3 = '–í–≥–∞–¥–∞–π —Ä—ñ–∫ –≤–∏–ø—É—Å–∫—É –∞–≤—Ç–æ'
button_4 = '–ë–∞–ª–∞–Ω—Å üíµ'
markup_keyb_global.add(button_1, button_2)
markup_keyb_global.add(button_3)
markup_keyb_global.add(button_4)


def Tips_keyb():
    keyb = types.InlineKeyboardMarkup()
    button_a = types.InlineKeyboardButton('–Ø –∑–≥–æ–¥–µ–Ω', callback_data='Agree')
    button_d = types.InlineKeyboardButton("–Ø –Ω–µ –∑–≥–æ–¥–µ–Ω", callback_data='Disagree')
    keyb.add(button_a,button_d)
    return keyb


# –§—É–Ω–∫—Ü—ñ—è —â–æ –≤–∏–∑–∏–≤–∞—î –∫–ª–∞–≤—ñ–∞—Ç—É—Ä—É –∑ –∫–Ω–æ–ø–æ–∫—é –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≥—Ä–∏ —Ç–∞ –ø—ñ–¥—Å–∫–∞–∑–∫–∞–º–∏
def cancel_keyb():
    markup_keyb = types.ReplyKeyboardMarkup()
    markup_keyb.add('–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –≥—Ä—É')
    markup_keyb.add('–ü—ñ–¥—Å–∫–∞–∑–∫–∞ üí°')
    return markup_keyb

# –§—É–Ω–∫—Ü—ñ—è –Ω–∞–¥—Å–∏–ª–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏, –æ–Ω—É–ª—è—î —Ä–∞—Ö—É–Ω–æ–∫ —Ç–∞ –≤–∏–∑–∏–≤–∞—î –º–µ–Ω—é-–∫–ª–∞–≤—ñ–∞—Ç—É—Ä—É
def send_results(message):
    global Correct_answers, Incorrect_answers, isModeStarted,Results
    isModeStarted = False
    Results["Coins"] += Results["Points"] * 2
    bot.send_message(message.chat.id,
                     f'üèÅ –ì—Ä—É –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ! \n\n'
                     f'‚úÖ –í–∏ –≤—ñ–¥–ø–æ–≤—ñ–ª–∏ –Ω–∞ {Results["Correct_answers"]} –∑ {Results["Correct_answers"]+Results["Incorrect_answers"]}\n\n'
                     f'üèÜ –í—Å—å–æ–≥–æ –±–∞–ª—ñ–≤ –Ω–∞–±—Ä–∞–Ω–æ: {Results["Points"]}\n\n'
                     f'üíµ –ó–∞ —Ü–µ –≤–∏ –æ—Ç—Ä–∏–º–∞–ª–∏ {Results["Points"] * 2} –º–æ–Ω–µ—Ç, —è–∫—ñ –º–æ–∂–µ—Ç–µ –≤–∏—Ç—Ä–∞—Ç–∏—Ç–∏ –Ω–∞ –ø—ñ–¥—Å–∫–∞–∑–∫–∏',
                     reply_markup=markup_keyb_global)

    Results['Correct_answers'] = 0
    Results['Incorrect_answers'] = 0
    Results['Points'] = 0
    isModeStarted = False


# –°–∞–º–∞ –≥—Ä–∞
def game(message):
    global current_mode, list_ph, rand_list, isModeStarted, year, list_years,message_id, Tip, checker
# –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –µ–ª–µ–º–µ–Ω—Ç—ñ–≤, —è–∫—â–æ –≥—Ä–∞ —â–µ –Ω–µ —Ä–æ–∑–ø–æ—á–∞—Ç–∞
    if not isModeStarted:
        list_ph = listdir(current_mode)
        rand_list = list_ph.copy()

    isModeStarted = True

    if current_mode == 'Logos' or current_mode == 'Pictures':
        global temp_list, name, ph_data
        if not Tip and checker:
            temp_list = [] #–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Ä–∞–Ω–¥–æ–º–Ω–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤(–¥–ª—è –≤–∏–±–æ—Ä—É)
            name = choice(list_ph) #–í–∏–±—ñ—Ä –µ–ª–µ–º–µ–Ω—Ç—É —è–∫–∏–π —Ç—Ä–µ–±–∞ –≤–≥–∞–¥–∞—Ç–∏
            list_ph.pop(list_ph.index(name)) #–í–∏–¥–∞–ª–µ–Ω–Ω—è —Ü—å–æ–≥–æ –µ–ª–µ–º–µ–Ω—Ç—É –∑—ñ —Å–ø–∏—Å–∫—É
            rand_list.pop(rand_list.index(name))

            with open(f'{current_mode}/{name}', 'rb') as ph: #–∑—á–∏—Ç—É–≤–∞–Ω–Ω—è –¥–∞–Ω–Ω–∏—Ö —Ñ–æ—Ç–æ
                ph_data = ph.read()

        inl_keyb = types.InlineKeyboardMarkup() #—Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–Ω–ª–∞–π–Ω –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏
        if Tip:
            count = 2
        else:
            count = 4

        if len(list_ph) > 1: #–ü–æ–∫–∏ —î –æ–±'—î–∫—Ç–∏ –¥–ª—è –ø–∏—Ç–∞–Ω–Ω—è
            num = randint(1, count)  # —Ü–µ —Ä–∞–Ω–¥–æ–º–Ω–µ —á–∏—Å–ª–æ —â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ —Ç–µ –Ω–∞ —è–∫–æ–º—É –º—ñ—Å—Ü—ñ –±—É–¥–µ –ø—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å
            for i in range(1,count+1):
                if num == i: #–í—Å—Ç–∞–≤–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –¥–æ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏
                    button = types.InlineKeyboardButton(name.split('.')[0], callback_data='True')
                    inl_keyb.add(button)
                else: #–í—Å—Ç–∞–≤–∫–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π –¥–æ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏
                    name_rand = choice(rand_list)
                    button = types.InlineKeyboardButton(name_rand.split('.')[0], callback_data='False')
                    inl_keyb.add(button)
                    rand_list.pop(rand_list.index(name_rand))
                    temp_list.append(name_rand) #–î–æ–¥–∞—î –µ–ª–µ–º–µ–Ω—Ç –¥–æ —Ç–∏–º—á–∞—Å–æ–≤–æ–≥–æ —Å–ø–∏—Å–∫—É
            rand_list.append(name) #–ü–æ–≤–µ—Ä—Ç–∞—î –µ–ª–µ–º–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –¥–æ —Å–ø–∏—Å–∫—É –∑ —Ä–∞–Ω–¥–æ–º–Ω–∏–º–∏
            if message_id:
                bot.delete_message(message.chat.id, message_id) #–í–∏–¥–∞–ª—è—î –º–∏–Ω—É–ª–µ –ø–∏—Ç–∞–Ω–Ω—è

            message_id = bot.send_photo(message.chat.id, #–ù–∞–¥—Å–∏–ª–∞—î –Ω–∞—Å—Ç—É–ø–Ω–µ –ø–∏—Ç–∞–Ω–Ω—è
                           ph_data,
                           reply_markup=inl_keyb).message_id
            Tip = False
            checker = True

            for el in temp_list:
                rand_list.append(el) #–ü–æ–≤–µ—Ä—Ç–∞—î –µ–ª–µ–º–µ–Ω—Ç–∏ –¥–æ —Ä–∞–Ω–¥–æ–º–Ω–æ–≥–æ —Å–ø–∏—Å–∫—É
        else: #–Ø–∫—â–æ –µ–ª–µ–º–µ–Ω—Ç–∏ –∑–∞–∫—ñ–Ω—á–∏–ª–∏—Å—è
            bot.send_message(message.chat.id,
                             '–ê–≤—Ç–æ–º–æ–±—ñ–ª—ñ –∑–∞–∫—ñ–Ω—á–∏–ª–∏—Å—è ü§∑‚Äç‚ôÇÔ∏è')

            send_results(message)

    elif current_mode == 'Year': #–õ–æ–≥—ñ–∫–∞ –¥–ª—è —Ç—Ä–µ—Ç—å–æ–≥–æ —Ä–µ–∂–∏–º—É
        name = choice(list_ph) #–û–±—Ä–∏–∞—î –µ–ª–µ–º–µ–Ω—Ç —è–∫–∏–π —Ç—Ä–µ–±–∞ –≤–≥–∞–¥–∞—Ç–∏
        year = (name.split('.')[0])[:-2] #–ë–µ—Ä–µ –Ω–∞–∑–≤—É –±–µ–∑ –∑–∞–π–≤–∏—Ö –∑–Ω–∞–∫—ñ–≤
        list_ph.pop(list_ph.index(name)) #–í–∏–¥–∞–ª–∞—è—î –µ–ª–µ–º–µ–Ω—Ç –∑—ñ —Å–ø–∏—Å–∫—É

        if len(list_ph) > 1:
            with open(f'{current_mode}/{name}', 'rb') as ph:
                ph_data = ph.read()
            bot.send_photo(message.chat.id,
                           ph_data)
        else:
            bot.send_message(message.chat.id,
                             '–ê–≤—Ç–æ–º–æ–±—ñ–ª—ñ –∑–∞–∫—ñ–Ω—á–∏–ª–∏—Å—è ü§∑‚Äç‚ôÇÔ∏è')
            send_results(message)
        return year


@bot.message_handler(commands=['start'])
def start_game(message):
    global markup_keyb_global, isStarted
    if message.text == '/start':
        isStarted = True
        bot.send_message(message.chat.id, '–í—ñ—Ç–∞—é —Ç–µ–±–µ, –î—Ä—É–∂–µ.')
        bot.send_message(message.chat.id, f'–î–ª—è –ø–æ—á–∞—Ç–∫—É –≥—Ä–∏ –æ–±–µ—Ä–∏ —Ä–µ–∂–∏–º –Ω–∏–∂—á–µ:  ',
                         reply_markup = markup_keyb_global) #–í–∏–∫–ª–∏–∫ –≥–ª–æ–±–∞–ª—å–Ω–æ—ó –∫–ª–∞–≤—ñ–∞—Ç—É—Ä–∏


@bot.message_handler(content_types='text')
def mode_select(message):
    global current_mode,isModeStarted, Results, Tip
    if isStarted:
        if not isModeStarted: #–†–µ–∞–≥—É—î –Ω–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–ª—è –≤–∏–±—ñ—Ä—É —Ä–µ–∂–∏–º—É –≥—Ä–∏
            if message.text == '–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –≥—Ä—É':
                bot.send_message(message.chat.id,
                                 '–ì—Ä—É —â–µ –Ω–µ —Ä–æ–∑–ø–æ—á–∞—Ç–æ. –Ø–∫—â–æ –±–∞–∂–∞—î—Ç–µ —Ä–æ–∑–ø–æ—á–∞—Ç–∏, –æ–±–µ—Ä—ñ—Ç—å —Ä–µ–∂–∏–º –Ω–∏–∂—á–µ.', reply_markup=markup_keyb_global)

            elif message.text == '–í–≥–∞–¥–∞–π –ª–æ–≥–æ—Ç–∏–ø':
                current_mode = 'Logos'

                bot.send_message(message.chat.id,
                                 '–í–∞—à–∞ –∑–∞–¥–∞—á–∞ –≤–≥–∞–¥–∞—Ç–∏ —â–æ –∑–∞ –ª–æ–≥–æ—Ç–∏–ø –∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ —Ñ–æ—Ç–æ —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—É—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—É –∫–Ω–æ–ø–∫—É '
                                 '–ø—ñ–¥ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è–º', reply_markup=cancel_keyb())
                game(message)
            elif message.text == '–í–≥–∞–¥–∞–π –º–∞—Ä–∫—É –∑–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–º —Ñ–æ—Ç–æ':
                current_mode = 'Pictures'
                bot.send_message(message.chat.id,
                                 '–í–∞—à–∞ –∑–∞–¥–∞—á–∞ –≤–≥–∞–¥–∞—Ç–∏ —â–æ –∑–∞ –∞–≤—Ç–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω–æ –Ω–∞ —Ñ–æ—Ç–æ —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—É—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—É –∫–Ω–æ–ø–∫—É '
                                 '–ø—ñ–¥ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è–º', reply_markup=cancel_keyb())
                game(message)
            elif message.text == '–í–≥–∞–¥–∞–π —Ä—ñ–∫ –≤–∏–ø—É—Å–∫—É –∞–≤—Ç–æ':
                current_mode = 'Year'
                bot.send_message(message.chat.id,
                                 f'–í–∞—à–∞ –∑–∞–¥–∞—á–∞ –≤–≥–∞–¥–∞—Ç–∏ —è–∫–∏–π —Ä—ñ–∫ –≤–∏–ø—É—Å–∫—É –∞–≤—Ç–æ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω–æ–≥–æ –Ω–∞ —Ñ–æ—Ç–æ —Ç–∞ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å.\n\n'
                                 f'–Ø–∫—â–æ –≤–∞—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è –≤—ñ–¥ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó –Ω–µ –±—ñ–ª—å—à–µ –Ω—ñ–∂ –Ω–∞ 2 —Ä–æ–∫–∏: +3 –±–∞–ª–∏\n\n'
                                 f'–Ø–∫—â–æ –≤–∞—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –¥–æ—Ä—ñ–≤–Ω—é—î –ø—Ä–∞–≤–∏–ª—å–Ω—ñ–π: +5 –±–∞–ª—ñ–≤', reply_markup=cancel_keyb())
                game(message)

            elif message.text == '–ë–∞–ª–∞–Ω—Å üíµ':
                bot.send_message(message.chat.id, f'üíµ –í–∞—à –ø–æ—Ç–æ—á–Ω–∏–π –±–∞–ª–∞–Ω—Å: \n\n{Results["Coins"]} –º–æ–Ω–µ—Ç')
                bot.send_message(message.chat.id, f'\n\n–¶—ñ –º–æ–Ω–µ—Ç–∏ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è –ø—ñ–¥—Å–∫–∞–∑–æ–∫ ')
        elif isModeStarted:
            if message.text == '–ó–∞–≤–µ—Ä—à–∏—Ç–∏ –≥—Ä—É':
                send_results(message)
            elif message.text == '–ü—ñ–¥—Å–∫–∞–∑–∫–∞ üí°':
                if Results["Coins"] > 5:
                    bot.send_message(message.chat.id, f'–Ø–∫—â–æ –≤–∏ –±–∞–∂–∞—î—Ç–µ —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—è –ø—ñ–¥—Å–∫–∞–∑–∫–æ—é, —Ç–æ –∑ –≤–∞—à–æ–≥–æ –±–∞–ª–∞–Ω—Å—É –±—É–¥–µ –∑–Ω—è—Ç–æ 5 –º–æ–Ω–µ—Ç.\n'
                                                      f'\n–í–∞—à –ø–æ—Ç–æ—á–Ω–∏–π –±–∞–ª–∞–Ω—Å: {Results["Coins"]}\n'
                                                      f'\n–í–∏ –∑–≥–æ–¥–Ω—ñ?', reply_markup=Tips_keyb())

                else:
                    bot.send_message(message.chat.id,'–ù–∞ –≤–∞—à–æ–º—É –±–∞–ª–∞–Ω—Å—ñ –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –º–æ–Ω–µ—Ç. –î–ª—è —Ü—å–æ–≥–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ —â–æ–Ω–∞–π–º–µ–Ω—à–µ 5 –º–æ–Ω–µ—Ç.')

            elif current_mode == 'Year': #–õ–æ–≥—ñ–∫–∞ –Ω–∞—Ä–∞—Ö–æ–≤—É–≤–∞–Ω–Ω—è –±–∞–ª—ñ–≤ –≤ —Ç—Ä–µ—Ç—å–æ–º—É —Ä–µ–∂–∏–º—ñ –≥—Ä–∏
                if message.text == year:
                    Results['Correct_answers'] += 1
                    bot.send_message(message.chat.id,
                                     f'–í—ñ–¥–ø–æ–≤—ñ–¥—å –ø—Ä–∞–≤–∏–ª—å–Ω–∞ ‚úÖ\n\n–í–∞–º –Ω–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ +5 –±–∞–ª—ñ–≤')
                    Results["Points"] += 5
                    game(message)

                elif int(message.text) >= int(year)-2 and int(message.text) <= int(year)+2:
                    Results['Correct_answers'] += 1
                    bot.send_message(message.chat.id,
                                     f'–í–∏ –º–∞–π–∂–µ –≤–≥–∞–¥–∞–ª–∏. –¶–µ–π –∞–≤—Ç–æ–º–æ–±—ñ–ª—å {year} —Ä–æ–∫—É\n\n'
                                     f'–í–∞–º –Ω–∞—Ä–∞—Ö–æ–≤–∞–Ω–æ +3 –±–∞–ª–∏ ')
                    Results["Points"] += 3
                    game(message)

                elif message.text != year:
                    Results['Incorrect_answers'] += 1
                    bot.send_message(message.chat.id,
                                     f'–í—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞ ‚ùå.\n–ü—Ä–∞–≤–∏–ª—å–Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å: {year}')
                    game(message)

    else:
        bot.send_message(message.chat.id,
                         f'–°–ø–æ—á–∞—Ç–∫—É —Ç—Ä–µ–±–∞ –ø—Ä–æ–ø–∏—Å–∞—Ç–∏ /start')


@bot.callback_query_handler(lambda a: True)
def get_query(query): #–û–±—Ä–æ–±–∫–∞ –Ω–∞—Ç–∏—Å–Ω–µ–Ω—å –Ω–∞ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä—É –¥–ª—è –ø–µ—Ä—à–∏—Ö –¥–≤–æ—Ö —Ä–µ–∂–∏–º—ñ–≤
    global Correct_answers, Incorrect_answers, Results, Tip, checker
    if query.data == 'True':
        Results['Correct_answers'] += 1
        Results["Points"] += 2
        bot.send_message(query.message.chat.id,
                         f'–í—ñ–¥–ø–æ–≤—ñ–¥—å –ø—Ä–∞–≤–∏–ª—å–Ω–∞ ‚úÖ\n\n+2 –±–∞–ª–∏')
        game(query.message)
    elif query.data == 'False':
        Results['Incorrect_answers'] += 1
        bot.send_message(query.message.chat.id,
                         f'–í—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞ ‚ùå')
        game(query.message)

    elif query.data == 'Agree':
        Results["Coins"] -= 5
        if current_mode == 'Logos' or current_mode == 'Pictures':
            Tip = True
            game(query.message)
        elif current_mode == 'Year':
            bot.send_message(query.message.chat.id,
                             f'–¶–µ–π –∞–≤—Ç–æ –±—É–ª–æ –≤–∏–ø—É—â–µ–Ω–Ω–æ —É –ø—Ä–æ–º—ñ–∂–∫—É –≤—ñ–¥ {int(year) - 3} –¥–æ {int(year) + 3}')

    elif query.data == 'Disagree':
        checker = False
        game(query.message)

bot.polling()